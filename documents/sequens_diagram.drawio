<mxfile host="65bd71144e">
    <diagram id="HuguGPZRIKFtp77_Nc6M" name="Page-1">
        <mxGraphModel dx="2876" dy="-352" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" background="#FFFFFF" math="0" shadow="1">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="74" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
                    <mxGeometry x="40" y="1400" width="100" height="1200" as="geometry"/>
                </mxCell>
                <mxCell id="75" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="74" vertex="1">
                    <mxGeometry x="45" y="80" width="10" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="77" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="74" vertex="1">
                    <mxGeometry x="45" y="170" width="10" height="610" as="geometry"/>
                </mxCell>
                <mxCell id="78" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="74" vertex="1">
                    <mxGeometry x="46" y="856" width="10" height="240" as="geometry"/>
                </mxCell>
                <mxCell id="79" value="Server" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="1" vertex="1">
                    <mxGeometry x="720" y="1400" width="100" height="1200" as="geometry"/>
                </mxCell>
                <mxCell id="80" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="79" vertex="1">
                    <mxGeometry x="45" y="240" width="10" height="470" as="geometry"/>
                </mxCell>
                <mxCell id="81" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="79" vertex="1">
                    <mxGeometry x="45" y="81" width="10" height="39" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="" style="html=1;points=[[0,0,0,0,5],[0,1,0,0,-5],[1,0,0,0,5],[1,1,0,0,-5]];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;curved&quot;:0,&quot;rounded&quot;:0};" parent="79" vertex="1">
                    <mxGeometry x="46" y="856" width="10" height="240" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="HSECRET = SHA256(SECRET)" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="97" y="1483" width="192" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="85" value="Init the GUI and dispay the GUI" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="97" y="1519" width="203" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="87" value="Establish session" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;rotation=-90;" parent="1" vertex="1">
                    <mxGeometry x="-419.5" y="2055.5" width="985" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="94" value="Init PSA, onboard LED, GPIO 4, temperature, UART" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="778" y="1483" width="382" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="95" value="Init the Serial communication" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="97" y="1502" width="183" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="96" value="&lt;div&gt;Convert the HSECRET string to binary&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="778" y="1503" width="239" height="24" as="geometry"/>
                </mxCell>
                <mxCell id="97" value="Message request" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;rotation=-90;" parent="1" vertex="1">
                    <mxGeometry x="-43" y="2364" width="234" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="98" value="- Generate random IV&lt;div&gt;&lt;span style=&quot;color: rgb(0, 0, 0);&quot;&gt;- CIPHER, TAG =&amp;nbsp; Encrypt Request + time_stamp with&amp;nbsp; SESSION_ID as AAD&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(0, 0, 0);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="97" y="2257" width="312" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="100" value="" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;exitX=1;exitY=0;exitDx=0;exitDy=5;exitPerimeter=0;" parent="1" edge="1">
                    <mxGeometry x="-0.0299" y="7" width="80" relative="1" as="geometry">
                        <mxPoint x="96" y="2311" as="sourcePoint"/>
                        <mxPoint x="766" y="2311" as="targetPoint"/>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="102" value="&lt;div&gt;- request, time_stamp[8] = decrypt CIPHER with SESSION_KEY as key and SESSION_ID as AAD&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="778" y="2319" width="292" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="108" value="&amp;nbsp;If (no valid message for 60 seconds)&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Session expired&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- LED = RED&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="772" y="2543" width="199" height="53" as="geometry"/>
                </mxCell>
                <mxCell id="114" value="" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="762" y="2452" as="sourcePoint"/>
                        <mxPoint x="98" y="2452.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="117" value="" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" parent="1" edge="1">
                    <mxGeometry width="80" relative="1" as="geometry">
                        <mxPoint x="95" y="1648" as="sourcePoint"/>
                        <mxPoint x="765.5" y="1648" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="118" value="Send( IV + CIPHER + TAG )" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="335" y="1629" width="198" height="19" as="geometry"/>
                </mxCell>
                <mxCell id="130" value="Send( IV, CIPHER, TAG )" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="370" y="2293" width="140" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="131" value="Send(IV, CIPHER, TAG )" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="370" y="2431" width="135" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="137" value="- validate time_stamp and execute request&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;- Generate random IV&lt;br&gt;&lt;/font&gt;&lt;div&gt;- CIPHER = encrypt status, time_stamp, request_state witch SESSION_KEY as key and SESSION_ID as AAD&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="778" y="2364" width="282" height="76" as="geometry"/>
                </mxCell>
                <mxCell id="143" value="&lt;div&gt;- stata, time_stamp[8], request_state = decrypt CIPHER with SESSION_KEY as key and SESSION_ID as AAD&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;log the status, time_stamp and request_state on the window&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="100" y="2462" width="220" height="98" as="geometry"/>
                </mxCell>
                <mxCell id="145" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-10" y="1330" width="50" height="53" as="geometry"/>
                </mxCell>
                <mxCell id="146" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry y="2280" width="50" height="53" as="geometry"/>
                </mxCell>
                <mxCell id="147" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1080" y="1340" width="50" height="53" as="geometry"/>
                </mxCell>
                <mxCell id="148" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1062" y="2389" width="50" height="47" as="geometry"/>
                </mxCell>
                <mxCell id="154" value="Send( IV + CIPHER + TAG )" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" parent="1" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="764.9999999999995" y="1766" as="sourcePoint"/>
                        <mxPoint x="95" y="1766" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="156" value="Send( IV + CIPHER + TAG )" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;" parent="1" edge="1">
                    <mxGeometry width="80" relative="1" as="geometry">
                        <mxPoint x="98" y="1921" as="sourcePoint"/>
                        <mxPoint x="765" y="1921" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="158" value="Send( IV, CIPHER, TAG )" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;" parent="1" edge="1">
                    <mxGeometry x="0.001" relative="1" as="geometry">
                        <mxPoint x="765" y="2096" as="sourcePoint"/>
                        <mxPoint x="95" y="2096" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="510" y="2096"/>
                        </Array>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="161" value="&lt;span style=&quot;color: rgb(0, 0, 0);&quot;&gt;- Generate random local SESSION_KEY[32], IV[12],&amp;nbsp; RAND8]&lt;/span&gt;&lt;div&gt;&lt;div&gt;- SESSION_ID[8] = 0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;- CIPHER, TAG = Encrypt SESSION_KEY + RAND with HSECRET as key and SESSION_ID as AAD&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="100" y="1570" width="350" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="163" value="&lt;div&gt;- SESSION_KEY[32], RAND[8] = decrypt CIPHER using HSECRET as key&lt;/div&gt;&lt;div&gt;- Store SESSION_KEY[32] and RAND[8] locally&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- Generat random local SESSION_ID[8] and IV[12]&lt;/div&gt;&lt;div&gt;- CIPHER, TAG = Encrypt SESSION_ID[8] with SESSION_KEY as key and&lt;span style=&quot;color: rgb(63, 63, 63); background-color: transparent;&quot;&gt;&amp;nbsp;RAND as AAD&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="780" y="1650" width="356.5" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="164" value="- SESSION_ID = decrypt CIPHER&amp;nbsp;&lt;div&gt;&amp;nbsp;with SESSION_KEY as key and RAND as AAD&lt;div&gt;- store SESSION_ID locally&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- time_stamp[8] = The current time in micro seconds&lt;/div&gt;&lt;div&gt;- Generatet random IV&lt;/div&gt;&lt;div&gt;- CIPHER, TAG = encrypt time_stamp with SESSION_KEY as key and&amp;nbsp;&lt;span style=&quot;color: rgb(63, 63, 63); background-color: transparent;&quot;&gt;SESSION_ID as AAD&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="99" y="1771" width="290" height="139" as="geometry"/>
                </mxCell>
                <mxCell id="165" value="- time_stamp[8] = decrypt CIPHER with SESSION_KEY as key and SESSION_ID as AAD&lt;div&gt;- Set internal RTC to time_stamp&lt;/div&gt;&lt;div&gt;- Store SESSION_KEY[32] and SESSION_ID gobally&lt;/div&gt;&lt;div&gt;- Set session_state to active&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- Generate random IV&lt;/div&gt;&lt;div&gt;- CIPHER, TAG_S = encrypt time_stamp with&lt;span style=&quot;background-color: transparent;&quot;&gt;&amp;nbsp;SESSION_KEY as key&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(63, 63, 63); background-color: transparent;&quot;&gt;and use SESSION_ID as AAD&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="779" y="1926" width="341" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="166" value="- time_stamp_received = decrypt CIPHER with SESSION_KEY as key and SESSION_ID as AAD&lt;div&gt;- Verify time_stamp == time_stamp_received&lt;/div&gt;&lt;div&gt;- Set SESSION_ID to global SESSION_ID&lt;/div&gt;&lt;div&gt;- Store SESSION_KEY[32] and SESSION_ID globally&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="99" y="2107" width="291" height="79" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>